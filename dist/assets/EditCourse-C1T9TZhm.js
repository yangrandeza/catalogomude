import{p as M,a as B,b as D,r as j,j as e,L as w,d as i}from"./index-CQAG8VK0.js";import{z as c,u as L,F as k,a as l,b as d,c as m,d as u,e as x,t as T}from"./form-C8Jww-IK.js";import{I as v}from"./input-Cw1N9oJN.js";import{T as R,X as _,I as O,U as G}from"./textarea-Bz3SmYKW.js";import{a as U,u as V}from"./courseService-BuGxHIX5.js";import{A as X}from"./arrow-left-DubhSE8H.js";const E=100*1024*1024,Y=["image/jpeg","image/jpg","image/png","image/webp"],Z=["application/zip"],J=c.object({name:c.string().min(1,"Nome do curso é obrigatório"),description:c.string().optional(),category:c.string().min(1,"Categoria do curso é obrigatória"),coverImage:c.instanceof(File).refine(a=>a.size<=E,"A imagem deve ter no máximo 100MB").refine(a=>Y.includes(a.type),"Apenas arquivos .jpg, .jpeg, .png e .webp são aceitos").optional().nullable(),scormFile:c.instanceof(File).refine(a=>a.size<=E,"O arquivo deve ter no máximo 100MB").refine(a=>Z.includes(a.type),"Apenas arquivos .zip são aceitos").optional().nullable()}),se=()=>{const{id:a}=M(),n=B(),{toast:p}=D(),[b,f]=j.useState(null),[F,y]=j.useState(!0),[N,C]=j.useState(!1),t=L({resolver:T(J),defaultValues:{name:"",description:"",category:"",coverImage:null,scormFile:null}});j.useEffect(()=>{a&&z(a)},[a]);const z=async s=>{y(!0);try{const r=await U(s);r?(t.reset({name:r.name,description:r.description,category:r.category,coverImage:null,scormFile:null}),f(r.coverImage)):(p({title:"Erro",description:"Curso não encontrado.",variant:"destructive"}),n("/admin"))}catch{p({title:"Erro",description:"Não foi possível carregar o curso.",variant:"destructive"}),n("/admin")}finally{y(!1)}},S=async s=>{if(a){C(!0);try{await V(a,s),p({title:"Sucesso",description:"Curso atualizado com sucesso."}),n("/admin")}catch{p({title:"Erro",description:"Não foi possível atualizar o curso.",variant:"destructive"})}finally{C(!1)}}},A=s=>{var g;const r=(g=s.target.files)==null?void 0:g[0];if(r){t.setValue("coverImage",r);const o=new FileReader;o.onload=()=>{f(o.result)},o.readAsDataURL(r)}},P=()=>{t.setValue("coverImage",null),f(null)};return F?e.jsx("div",{className:"flex justify-center items-center py-16",children:e.jsx(w,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-800 via-purple-800 to-purple-900",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-8",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>n("/admin"),children:e.jsx(X,{size:18})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Editar Curso"})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg border shadow-sm",children:e.jsx(k,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(S),className:"space-y-6",children:[e.jsx(l,{control:t.control,name:"name",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Nome do Curso *"}),e.jsx(u,{children:e.jsx(v,{placeholder:"Digite o nome do curso",...s})}),e.jsx(x,{})]})}),e.jsx(l,{control:t.control,name:"description",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Descrição"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Digite a descrição do curso",...s,rows:4})}),e.jsx(x,{})]})}),e.jsx(l,{control:t.control,name:"category",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Categoria *"}),e.jsx(u,{children:e.jsx(v,{placeholder:"Digite a categoria do curso",...s})}),e.jsx(x,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:t.control,name:"coverImage",render:()=>e.jsxs(d,{children:[e.jsx(m,{children:"Imagem de Capa"}),e.jsx(u,{children:e.jsx("div",{className:"space-y-4",children:b?e.jsxs("div",{className:"relative h-60 w-full rounded-md overflow-hidden border",children:[e.jsx("img",{src:b,alt:"Prévia da capa",className:"h-full w-full object-cover"}),e.jsx(i,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2",onClick:P,children:e.jsx(_,{size:16})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 border-2 border-dashed rounded-md border-gray-300 p-6",children:[e.jsx(O,{size:48,className:"text-gray-400 mb-4"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Arraste e solte a imagem aqui ou clique para escolher"}),e.jsx("p",{className:"text-xs text-gray-500",children:"JPG, PNG ou WebP (max. 100MB)"})]}),e.jsx(v,{type:"file",className:"hidden",accept:"image/jpeg,image/jpg,image/png,image/webp",id:"coverImage",onChange:A}),e.jsx(i,{type:"button",variant:"secondary",className:"mt-4",onClick:()=>{var s;return(s=document.getElementById("coverImage"))==null?void 0:s.click()},children:"Escolher Imagem"})]})})}),e.jsx(x,{})]})}),e.jsx(l,{control:t.control,name:"scormFile",render:({field:{value:s,onChange:r,...g}})=>{var o;return e.jsxs(d,{children:[e.jsx(m,{children:"Pacote SCORM (.zip)"}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 border-2 border-dashed rounded-md border-gray-300 p-6",children:[e.jsx(G,{size:48,className:"text-gray-400 mb-4"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Arraste e solte o arquivo zip aqui ou clique para escolher"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Arquivo ZIP contendo o curso SCORM (max. 100MB)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Deixe em branco para manter o arquivo atual"})]}),e.jsx(v,{type:"file",className:"hidden",accept:".zip,application/zip",id:"scormFile",onChange:h=>{var I;const q=((I=h.target.files)==null?void 0:I[0])||null;r(q)},...g}),e.jsx(i,{type:"button",variant:"secondary",className:"mt-4",onClick:()=>{var h;return(h=document.getElementById("scormFile"))==null?void 0:h.click()},children:"Escolher Arquivo"}),t.watch("scormFile")&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Arquivo selecionado: ",(o=t.watch("scormFile"))==null?void 0:o.name]})]})}),e.jsx(x,{})]})}})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>n("/admin"),children:"Cancelar"}),e.jsxs(i,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition-colors",disabled:N,children:[N?e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Salvar Alterações"]})]})]})})})]})};export{se as default};
